@model Jointly.Models.Event
@{
    Layout = null;
    ViewData["Title"] = Model.Title;
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Jointly</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>
    <div class="event-page min-vh-100">
        <!-- Event Details -->
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card-soft p-0 mb-4 overflow-hidden">
                        <!-- Header Image at Top -->
                        <div class="position-relative" style="height: 300px;">
                            @if (!string.IsNullOrEmpty(Model.HeaderImagePath))
                            {
                                <img src="@Model.HeaderImagePath" alt="@Model.Title" style="width: 100%; height: 100%; object-fit: cover;">
                            }
                            else
                            {
                                <div class="bg-gradient-main w-100 h-100"></div>
                            }
                            <div class="hero-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                <div class="text-center text-white">
                                    <img src="~/images/logo.png" alt="Jointly" height="50" class="mb-3">
                                    <h1 class="display-4 fw-bold">@Model.Title</h1>
                                    @if (!Model.IsActive)
                                    {
                                        <span class="badge bg-secondary fs-6 mt-2">Bu etkinlik sonlandırılmıştır</span>
                                    }
                                </div>
                            </div>
                        </div>
                        
                        <!-- Event Details Content -->
                        <div class="p-4 p-md-5">
                            <h3 class="fw-bold mb-4">Etkinlik Detayları</h3>
                        
                        <div class="mb-4">
                            <h5 class="fw-semibold mb-2"><i class="bi bi-info-circle me-2 text-primary"></i>Açıklama</h5>
                            <p class="text-muted">@(string.IsNullOrEmpty(Model.Description) ? "Açıklama eklenmemiş" : Model.Description)</p>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <h5 class="fw-semibold mb-2"><i class="bi bi-calendar3 me-2 text-primary"></i>Tarih</h5>
                                <p class="text-muted mb-0">@Model.EventDate.ToString("dd MMMM yyyy, HH:mm")</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h5 class="fw-semibold mb-2"><i class="bi bi-geo-alt me-2 text-primary"></i>Konum</h5>
                                <p class="text-muted mb-0">@Model.Location</p>
                            </div>
                        </div>

                        <div class="text-center pt-4 border-top">
                            <p class="text-muted small mb-3">Düzenleyen: <strong>@Model.User?.FirstName @Model.User?.LastName</strong></p>
                            <img src="~/images/logo.png" alt="Jointly" height="30" class="opacity-50">
                        </div>
                    </div>
                    </div>

                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="bi bi-check-circle me-2"></i>@TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }
                    
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="bi bi-exclamation-triangle me-2"></i>@Html.Raw(TempData["ErrorMessage"])
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <!-- Media Upload Section -->
                    <div class="card-soft p-4 p-md-5 mb-4">
                        <div class="text-center mb-4">
                            <div class="upload-icon mb-3">
                                <i class="bi bi-cloud-upload display-1 text-primary"></i>
                            </div>
                            <h5 class="fw-bold mb-2">Anılarınızı Paylaşın</h5>
                            <p class="text-muted">Fotoğraf ve videolarınızı yükleyerek etkinliğin unutulmaz anlarını ölümsüzleştirin</p>
                        </div>

                        <form action="/Event/UploadMedia" method="post" enctype="multipart/form-data" id="uploadForm">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="eventId" value="@Model.Id" />
                            
                            <div class="upload-area mb-4" id="uploadArea">
                                <input type="file" class="d-none" id="file" name="files" accept="image/*,video/*" multiple required onchange="handleFileSelect(event)">
                                <label for="file" class="upload-label mb-0">
                                    <div class="upload-box">
                                        <i class="bi bi-image display-4 text-primary mb-3"></i>
                                        <h6 class="fw-semibold mb-2">Dosyalar seçmek için tıklayın veya sürükleyin</h6>
                                        <p class="text-muted small mb-0">Birden fazla dosya seçebilirsiniz • JPG, PNG, GIF, MP4 - Maksimum 10MB/dosya</p>
                                    </div>
                                    <div id="filePreview" class="mt-3"></div>
                                </label>
                            </div>

                            <div class="mb-4">
                                <label for="uploaderName" class="form-label fw-semibold">
                                    <i class="bi bi-person me-2"></i>Adınız (isteğe bağlı)
                                </label>
                                <input type="text" class="form-control form-control-lg" id="uploaderName" name="uploaderName" placeholder="Örn: Ahmet Yılmaz">
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="bi bi-cloud-upload me-2"></i>Yükle ve Paylaş
                            </button>
                        </form>
                    </div>

                    <!-- Message Section -->
                    <div class="card-soft p-4 p-md-5 mb-4">
                        <div class="text-center mb-4">
                            <div class="mb-3">
                                <i class="bi bi-chat-left-text display-1 text-primary"></i>
                            </div>
                            <h5 class="fw-bold mb-2">Mesaj Bırakın</h5>
                            <p class="text-muted">Etkinlik sahibine bir mesaj gönderin</p>
                        </div>

                        <form action="/Event/SubmitMessage" method="post" enctype="application/x-www-form-urlencoded" id="messageForm">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="eventId" value="@Model.Id" />
                            
                            <div class="mb-3">
                                <label for="message" class="form-label fw-semibold">
                                    <i class="bi bi-pencil me-2"></i>Mesajınız
                                </label>
                                <textarea class="form-control form-control-lg" id="message" name="message" rows="4" placeholder="Mesajınızı buraya yazın..." required maxlength="1000"></textarea>
                                <small class="text-muted">Maksimum 1000 karakter</small>
                            </div>

                            <div class="mb-4">
                                <label for="senderName" class="form-label fw-semibold">
                                    <i class="bi bi-person me-2"></i>Adınız (isteğe bağlı)
                                </label>
                                <input type="text" class="form-control form-control-lg" id="senderName" name="senderName" placeholder="Örn: Ahmet Yılmaz" maxlength="100">
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="bi bi-send me-2"></i>Mesajı Gönder
                            </button>
                        </form>
                    </div>

                    <!-- Voice Recording Section -->
                    <div class="card-soft p-4 p-md-5 mb-4">
                        <div class="text-center mb-4">
                            <div class="mb-3">
                                <i class="bi bi-mic-fill display-1 text-primary"></i>
                            </div>
                            <h5 class="fw-bold mb-2">Sesli Mesaj Bırakın</h5>
                            <p class="text-muted">Ses kaydı yapıp etkinlik sahibine gönderin</p>
                        </div>

                        <!-- Recording Timer -->
                        <div id="recordingTimer" class="text-center mb-4 d-none">
                            <div class="bg-light rounded-pill p-3 d-inline-block">
                                <i class="bi bi-record-circle text-danger me-2"></i>
                                <span class="fw-bold display-6" id="timerDisplay">00:00</span>
                            </div>
                        </div>

                        <!-- Single Toggle Button -->
                        <div class="text-center mb-4">
                            <button type="button" class="btn btn-danger btn-lg" id="recordToggleBtn" onclick="toggleRecording()">
                                <i class="bi bi-record-circle me-2"></i>Kayıt Başlat
                            </button>
                        </div>

                        <div id="recordingStatus" class="alert alert-info d-none mb-4" role="alert">
                            <i class="bi bi-hourglass-split me-2"></i><span id="statusText">Hazır</span>
                        </div>

                        <audio id="audioPlayback" class="w-100 mb-4 d-none" controls></audio>

                        <form action="/Event/UploadVoiceNote" method="post" enctype="multipart/form-data" id="voiceForm">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="eventId" value="@Model.Id" />
                            <input type="hidden" name="duration" id="recordingDuration" value="0" />
                            <input type="hidden" name="audioFile" id="audioFileInput" />

                            <div class="mb-4">
                                <label for="voiceSenderName" class="form-label fw-semibold">
                                    <i class="bi bi-person me-2"></i>Adınız (isteğe bağlı)
                                </label>
                                <input type="text" class="form-control form-control-lg" id="voiceSenderName" name="senderName" placeholder="Örn: Ahmet Yılmaz" maxlength="100">
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg w-100" id="uploadVoiceBtn" disabled>
                                <i class="bi bi-cloud-upload me-2"></i>Ses Kaydını Yükle
                            </button>
                        </form>
                    </div>

                    <!-- Media Gallery - Only visible to event owner -->
                    @{
                        var currentUserId = Context.Session.GetInt32("UserId");
                        var isOwner = currentUserId.HasValue && currentUserId.Value == Model.UserId;
                    }
                    
                    <!-- QR Code Section -->
                    <div class="card-soft p-4">
                        <h5 class="fw-bold mb-3 text-center">Etkinlik QR Kodu</h5>
                        @{
                            var baseUrl = $"{Context.Request.Scheme}://{Context.Request.Host}";
                            var eventUrl = $"{baseUrl}/Event/{Model.QRCode}";
                            var qrCodeBase64 = Jointly.Helpers.QRCodeHelper.GenerateQRCodeBase64(eventUrl);
                        }
                        <div class="text-center mb-3">
                            <img src="data:image/png;base64,@qrCodeBase64" alt="QR Code" id="qrCodeImage" style="max-width: 250px;" class="img-fluid mb-3">
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                            <button type="button" class="btn btn-primary" onclick="downloadQRCode()">
                                <i class="bi bi-download me-2"></i>QR Kodu İndir
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="copyEventLink()">
                                <i class="bi bi-link-45deg me-2"></i>Linki Kopyala
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="shareEvent()">
                                <i class="bi bi-share me-2"></i>Paylaş
                            </button>
                        </div>
                        <p class="text-muted small mb-0 mt-3 text-center">Bu QR kodu paylaşarak katılımcıları etkinliğe davet edebilirsiniz</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Media Viewer Modal -->
    <div class="modal fade" id="mediaModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <img id="modalImage" src="" class="img-fluid w-100" style="display: none;">
                    <video id="modalVideo" controls class="w-100" style="display: none;"></video>
                </div>
            </div>
        </div>
    </div>

    <style>
        .event-page {
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--white) 100%);
        }

        .hero-overlay {
            background: linear-gradient(135deg, rgba(183, 110, 121, 0.7) 0%, rgba(224, 129, 117, 0.6) 100%);
        }

        .bg-gradient-main {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .upload-area {
            transition: all 0.3s ease;
        }

        .upload-area.dragover {
            transform: scale(1.02);
        }

        .upload-label {
            cursor: pointer;
            display: block;
            padding: 2rem;
        }

        .upload-box {
            border: 3px dashed var(--primary-color);
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(183, 110, 121, 0.05) 0%, rgba(224, 129, 117, 0.05) 100%);
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .upload-area:hover .upload-box {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, rgba(183, 110, 121, 0.1) 0%, rgba(224, 129, 117, 0.1) 100%);
        }

        .upload-area.dragover .upload-box {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, rgba(183, 110, 121, 0.15) 0%, rgba(224, 129, 117, 0.15) 100%);
        }

        .upload-icon {
            animation: float 3s ease-in-out infinite;
        }

        @@keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .media-item {
            transition: transform 0.3s;
        }

        .media-item:hover {
            transform: scale(1.05);
        }
    </style>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // AJAX Upload
            const uploadForm = document.getElementById('uploadForm');
            if (uploadForm) {
                uploadForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(uploadForm);
                    const button = uploadForm.querySelector('button[type="submit"]');
                    const originalButtonText = button.innerHTML;
                    
                    // Disable button and show loading
                    button.disabled = true;
                    button.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Yükleniyor...';
                    
                    fetch('/Event/UploadMedia', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        button.disabled = false;
                        button.innerHTML = originalButtonText;
                        
                        if (response.ok || response.redirected) {
                            // Reset form
                            uploadForm.reset();
                            
                            // Show success toast
                            Swal.fire({
                                toast: true,
                                position: 'top-end',
                                icon: 'success',
                                title: 'Medya dosyalarınız başarıyla yüklendi!',
                                showConfirmButton: false,
                                timer: 4000,
                                timerProgressBar: true
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Hata!',
                                text: 'Yükleme sırasında bir hata oluştu. Lütfen tekrar deneyin.'
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Upload error:', error);
                        button.disabled = false;
                        button.innerHTML = originalButtonText;
                        
                        Swal.fire({
                            icon: 'error',
                            title: 'Hata!',
                            text: 'Yükleme sırasında bir hata oluştu: ' + error.message
                        });
                    });
                });
            }

            // Check for upload success notification on page load

            // Drag & Drop functionality
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('file');

            if (uploadArea && fileInput) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, preventDefaults, false);
                });

                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => {
                        uploadArea.classList.add('dragover');
                    }, false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => {
                        uploadArea.classList.remove('dragover');
                    }, false);
                });

                uploadArea.addEventListener('drop', (e) => {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    if (files.length > 0) {
                        fileInput.files = files;
                        handleFileSelect({ target: { files: files } });
                    }
                });
            }
        });

        function handleFileSelect(event) {
            const files = event.target.files;
            if (files && files.length > 0) {
                const preview = document.getElementById('filePreview');
                let previewHTML = '<div class="alert alert-info mb-0"><i class="bi bi-file-earmark-check me-2"></i>';
                
                if (files.length === 1) {
                    const fileName = files[0].name;
                    const fileSize = (files[0].size / 1024 / 1024).toFixed(2);
                    previewHTML += `<strong>${fileName}</strong> (${fileSize} MB)`;
                } else {
                    previewHTML += `<strong>${files.length} dosya seçildi</strong><ul class="mb-0 mt-2">`;
                    Array.from(files).forEach(file => {
                        const fileSize = (file.size / 1024 / 1024).toFixed(2);
                        previewHTML += `<li>${file.name} (${fileSize} MB)</li>`;
                    });
                    previewHTML += '</ul>';
                }
                
                previewHTML += '</div>';
                preview.innerHTML = previewHTML;
            }
        }

        function downloadQRCode() {
            const qrImage = document.getElementById('qrCodeImage');
            const link = document.createElement('a');
            link.download = 'qr-code.png';
            link.href = qrImage.src;
            link.click();
        }

        function copyEventLink() {
            const eventUrl = '@eventUrl';
            navigator.clipboard.writeText(eventUrl).then(() => {
                alert('Link kopyalandı!');
            }).catch(err => {
                console.error('Kopyalama hatası:', err);
            });
        }

        function shareEvent() {
            const eventUrl = '@eventUrl';
            const eventTitle = '@Model.Title';
            
            if (navigator.share) {
                navigator.share({
                    title: eventTitle,
                    text: 'Bu etkinliğe davetlisiniz!',
                    url: eventUrl
                }).catch(err => console.log('Paylaşım iptal edildi'));
            } else {
                copyEventLink();
            }
        }

        function viewMedia(filePath, type) {
            const modal = new bootstrap.Modal(document.getElementById('mediaModal'));
            const modalImage = document.getElementById('modalImage');
            const modalVideo = document.getElementById('modalVideo');
            
            if (type === 'image') {
                modalImage.src = filePath;
                modalImage.style.display = 'block';
                modalVideo.style.display = 'none';
            } else {
                modalVideo.src = filePath;
                modalVideo.style.display = 'block';
                modalImage.style.display = 'none';
            }
            
            modal.show();
        }

        // Voice Recording Functionality
        let mediaRecorder;
        let audioChunks = [];
        let recordedBlob;
        let startTime;
        let timerInterval;
        let isRecording = false;

        async function toggleRecording() {
            if (!isRecording) {
                await startRecording();
            } else {
                stopRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    recordedBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(recordedBlob);
                    const audioPlayback = document.getElementById('audioPlayback');
                    audioPlayback.src = audioUrl;
                    audioPlayback.classList.remove('d-none');
                    
                    document.getElementById('uploadVoiceBtn').disabled = false;
                    
                    const duration = Math.floor((Date.now() - startTime) / 1000);
                    document.getElementById('recordingDuration').value = duration;
                    
                    showStatus('Kayıt tamamlandı! Kayıt ' + formatTime(duration) + ' sürdü. Ses kaydını yüklemek için butona basın.', 'success');
                };

                mediaRecorder.start();
                startTime = Date.now();
                isRecording = true;
                
                // Update button
                const btn = document.getElementById('recordToggleBtn');
                btn.className = 'btn btn-secondary btn-lg';
                btn.innerHTML = '<i class="bi bi-stop-circle me-2"></i>Durdur';
                
                // Show timer
                document.getElementById('recordingTimer').classList.remove('d-none');
                
                // Start timer
                timerInterval = setInterval(updateTimer, 1000);
                
                document.getElementById('uploadVoiceBtn').disabled = true;
                showStatus('Kayıt yapılıyor...', 'danger');
            } catch (error) {
                console.error('Mikrofon erişim hatası:', error);
                alert('Mikrofona erişim izni verilmedi. Lütfen tarayıcı ayarlarından mikrofon izni verin.');
                isRecording = false;
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                
                // Stop timer
                clearInterval(timerInterval);
                isRecording = false;
                
                // Update button
                const btn = document.getElementById('recordToggleBtn');
                btn.className = 'btn btn-danger btn-lg';
                btn.innerHTML = '<i class="bi bi-record-circle me-2"></i>Kayıt Başlat';
                
                // Hide timer
                document.getElementById('recordingTimer').classList.add('d-none');
            }
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('timerDisplay').textContent = formatTime(elapsed);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function showStatus(text, type) {
            const statusDiv = document.getElementById('recordingStatus');
            const statusText = document.getElementById('statusText');
            
            statusDiv.classList.remove('d-none', 'alert-info', 'alert-danger', 'alert-success');
            statusDiv.classList.add(`alert-${type}`);
            statusText.textContent = text;
        }

        // Handle message form submission
        document.getElementById('messageForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const button = this.querySelector('button[type="submit"]');
            const originalButtonText = button.innerHTML;
            
            button.disabled = true;
            button.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Gönderiliyor...';
            
            try {
                const response = await fetch('/Event/SubmitMessage', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    this.reset();
                    
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'success',
                        title: 'Mesajınız başarıyla gönderildi!',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Hata!',
                        text: 'Mesaj gönderilirken bir hata oluştu. Lütfen tekrar deneyin.'
                    });
                }
            } catch (error) {
                console.error('Message submit error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Hata!',
                    text: 'Mesaj gönderilirken bir hata oluştu: ' + error.message
                });
            } finally {
                button.disabled = false;
                button.innerHTML = originalButtonText;
            }
        });
        
        // Handle voice form submission
        document.getElementById('voiceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!recordedBlob) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Uyarı',
                    text: 'Lütfen önce bir ses kaydı yapın.',
                    confirmButtonText: 'Tamam'
                });
                return;
            }
            
            const formData = new FormData(this);
            formData.set('audioFile', recordedBlob, 'recording.webm');
            
            const button = document.getElementById('uploadVoiceBtn');
            button.disabled = true;
            button.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Yükleniyor...';
            
            try {
                const response = await fetch('/Event/UploadVoiceNote', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    // Reset form and recording
                    recordedBlob = null;
                    document.getElementById('voiceForm').reset();
                    
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'success',
                        title: 'Sesli mesajınız başarıyla eklendi!',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    });
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Hata',
                    text: 'Yükleme sırasında bir hata oluştu.',
                    confirmButtonText: 'Tamam'
                });
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="bi bi-cloud-upload me-2"></i>Ses Kaydını Yükle';
            }
        });
    </script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>
